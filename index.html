<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
<style>

        /* Professional Blue Dot Pulse Effect */
.user-location-dot {
    background-color: #007AFF;
    border: 3px solid white;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(0, 122, 255, 0.5);
}

/* Styling for the Floating Button */
#location-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

    
    body { margin: 0; padding: 0; overflow: hidden; } /* Prevent body scrolling */
    #map {
        height: 100vh;
        width: 100%;
    }

    /* Base Tooltip Styling (Small Font, only visible on hover) */
    .leaflet-tooltip-pane .leaflet-tooltip {
        font-size: 10px !important; 
        padding: 4px 6px; 
    }
    
    /* --- NEW: Bottom Drawer Styling (Modified Max-Height) --- */
    #building-info-drawer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-height: 25vh; /* REDUCED MAX HEIGHT */
        background-color: white;
        box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
        z-index: 10000;
        padding: 20px;
        box-sizing: border-box;
        transform: translateY(100%);
        transition: transform 0.3s ease-out;
        overflow-y: auto; /* Allow content to scroll */
    }

    #building-info-drawer.visible {
        transform: translateY(0); /* Slide up to be visible */
    }

    #close-drawer {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #555;
    }

    /* REMOVED IMAGE CONTAINER STYLES */
</style>





</head>
<body>
    <div id="map"></div>
    <div id="building-info-drawer">
        <button id="close-drawer">‚úï</button>
        <div id="drawer-content">
            <h3 id="drawer-title"></h3>
            <p id="drawer-detail"></p>
            </div>
    </div>

<button id="location-btn" onclick="toggleTracking()">üìç</button>
    
    </body>
</html>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
<script>
    // 1. Map Initialization
    var map = L.map('map').setView([14.1089, 38.7110], 18); 

    // 2. Base Layers
    var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles ¬© Esri',
        maxZoom: 18 
    });
    
    var osmLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        maxZoom: 18 
    });

    satelliteLayer.addTo(map);



    // ==================================================
    // 4. STYLES, LAYER SETUP, AND HELPER FUNCTION (REVISED FOR DRAWER)
    // ==================================================

    // CRITICAL: LayerGroup to hold all buildings for search functionality (needed for proper click handling)
    var featuresLayer = new L.LayerGroup();
    featuresLayer.addTo(map);

    const defaultStyle = { 
        weight: 0, 
        fillColor: 'transparent', 
        fillOpacity: 0 
    };

    // Define category-specific hover styles
    const classStyle = { weight: 2, color: '#00cc66', fillColor: '#00cc66', fillOpacity: 0.2 }; // Green for Classrooms/Labs/Departments
    const adminStyle = { weight: 2, color: '#ff6666', fillColor: '#ff6666', fillOpacity: 0.2 }; // Red for Admin
    const dormStyle = { weight: 2, color: '#6699ff', fillColor: '#6699ff', fillOpacity: 0.2 }; // Blue for Dorms
    const artStyle = { weight: 2, color: '#cc66ff', fillColor: '#cc66ff', fillOpacity: 0.2 }; // Purple for Art Center
    const healthStyle = { weight: 2, color: '#ff9933', fillColor: '#ff9933', fillOpacity: 0.2 }; // Orange for Clinic/Health
    const commercialStyle = { weight: 2, color: '#ffcc00', fillColor: '#ffcc00', fillOpacity: 0.2 }; // Gold for Commercial/Cafe/Dining / Landmark
    
    // üö® REVISED Helper function to create the building polygon with interactivity
    // REMOVED: imageUrl parameter, it is no longer used
    function createBuilding(coords, label, detail, categoryStyle) {
        var polygon = L.polygon(coords, defaultStyle); 

        // Add properties directly to the polygon for easy access on click
        polygon.title = label; 
        polygon.description = detail; 
        // REMOVED: polygon.imageUrl = imageUrl; 
        
        // Define the hover/mouseout handlers specific to this polygon's style
        function highlightFeature(e) {
            e.target.setStyle(categoryStyle);
            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                e.target.bringToFront();
            }
        }
        function resetHighlight(e) {
            e.target.setStyle(defaultStyle);
        }
        
        // New function to handle the click event
        function clickHandler(e) {
            // 1. Zoom to the feature
            map.fitBounds(e.target.getBounds());
            
            // 2. Open the custom bottom drawer
            openBuildingDrawer(e.target);
        }

        // Apply interaction listeners
        polygon.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: clickHandler // Use the new click handler
        });

        // Add non-permanent (hover-only) tooltip
        polygon.bindTooltip(label, {permanent: false, direction: 'center'}); 
        
        // CRITICAL: Add the polygon to the featuresLayer (which is on the map)
        featuresLayer.addLayer(polygon); 

        return polygon;
    }


    // üö® NEW: Function to handle the bottom drawer display
    function openBuildingDrawer(layer) {
        const drawer = document.getElementById('building-info-drawer');
        
        // Update content
        document.getElementById('drawer-title').innerHTML = layer.title;
        document.getElementById('drawer-detail').innerHTML = layer.description;
        
        // REMOVED IMAGE LOGIC:
        // const imageContainer = document.getElementById('drawer-image-container');
        // imageContainer.innerHTML = ''; // Clear previous image
        // if (layer.imageUrl) { ... } else { ... }

        // Show the drawer (slides up via CSS transition)
        drawer.classList.add('visible');
    }

    // üö® NEW: Event listener to close the drawer
    document.getElementById('close-drawer').addEventListener('click', function() {
        document.getElementById('building-info-drawer').classList.remove('visible');
    });


    // ==================================================
    // 5. YOUR BUILDINGS (Updated calls by removing the null imageUrl argument)
    // ==================================================

    // --- BUILDING 1 (20) - Lab/Classroom (GREEN) ---
    var coords1 = [
        [14.108478112075138, 38.71125519275666], [14.108935940898695, 38.71150732040405], 
        [14.109232488623276, 38.71075093746186], [14.109008777217666, 38.710616827011116]
    ];
    createBuilding(coords1, "20", "<b>Building 20 Details</b><br>main conference hall", classStyle);


    // --- BUILDING 2 (21) - Admin Office (RED) ---
    var coords2 = [
        [14.10938856621808, 38.70921134948731], [14.109690315931706, 38.708910942077644], 
        [14.109471807558299, 38.708626627922065], [14.109097221287987, 38.70881974697114]
    ];
    createBuilding(coords2, "21", "<b>Building 21 Details</b><br>Digital Library.", adminStyle);

    
    // --- BUILDING 3 (32) - Dormitory (BLUE) ---
    var coords3 = [
        [14.106620774348372, 38.70777904987336], [14.106579153161555, 38.70752692222596], 
        [14.106240980736942, 38.70753228664399], [14.106277399329835, 38.70784878730774]
    ];
    createBuilding(coords3, "32", "<b>Building 32 Details</b><br>Male Dormitory.", dormStyle);


    // --- BUILDING 4 (42) - Dormitory (BLUE) ---
    var coords4 = [
        [14.106126522264228, 38.707870244979866], [14.10579875450178, 38.707902431488044], 
        [14.105767538499821, 38.707612752914436], [14.106074495666723, 38.70757520198823]
    ];
    createBuilding(coords4, "42", "<b>Building 42 Details</b><br>Male Dormitory.", dormStyle);
    

    // --- BUILDING 5 (31) - Dormitory (BLUE) ---
    var coords5 = [
        [14.106651990233514, 38.70733916759491], [14.106969351489738, 38.70729625225068], 
        [14.106932933007364, 38.70705485343934], [14.106615571700441, 38.707103133201606]
    ];
    createBuilding(coords5, "31", "<b>Block 31 Details</b><br>Male Dormitory.", dormStyle);


    // --- BUILDING 6 (84) - Registrarial/Admin (RED) ---
    var coords6 = [
        [14.10792663522592, 38.711845278739936], [14.107723733030596, 38.712134957313545], 
        [14.107609275302273, 38.71207594871522], [14.10779656973687, 38.71177017688752]
    ];
    createBuilding(coords6, "84", "<b>Block 84 Details</b><br>Registrarial Office.", adminStyle);


    // --- BUILDING 7 (76) - Lecture Classes (GREEN) ---
    var coords7 = [
        [14.103696867493348, 38.70979070663453], [14.103379501682328, 38.709849715232856], 
        [14.103343082626587, 38.709613680839546], [14.103670853918892, 38.70954394340516]
    ];
    createBuilding(coords7, "76", "<b>Block 76 Details</b><br>Lecture Classrooms.", classStyle);


    // --- BUILDING 8 (77) - Lecture Classes (GREEN) ---
    var coords8 = [
        [14.103696867493348, 38.71002137660981], [14.103400312568716, 38.71007502079011], 
        [14.103426326174036, 38.71028959751129], [14.10372808377877, 38.71026277542115]
    ];
    createBuilding(coords8, "77", "<b>Block 77 Details</b><br>Lecture Classrooms.", classStyle);


    // --- BUILDING 9 (78) - Lecture Classes (GREEN) ---
    var coords9 = [
        [14.103551191438218, 38.709125518798835], [14.103275447221915, 38.7091737985611], 
        [14.103228622699241, 38.70893776416779], [14.103514772409882, 38.708884119987495]
    ];
    createBuilding(coords9, "78", "<b>Block 78 Details</b><br>Lecture Classrooms.", classStyle);
    
    
    // --- BUILDING 10 (59) - Art Center (PURPLE) ---
    var coords10 = [
        [14.105944429121042, 38.70958685874939], [14.105772741167112, 38.709613680839546], 
        [14.105705106483102, 38.70919525623322], [14.105871591823044, 38.709157705307014]
    ];
    createBuilding(coords10, "59", "<b>Block 59 Details</b><br>Art Center.", artStyle);
    
    
    // --- BUILDING 11 (58) - ECE Department (GREEN) ---
    var coords11 = [
        [14.106100508966952, 38.7095332145691], [14.106246183393433, 38.70951712131501], 
        [14.106178548849863, 38.709141612052925], [14.106074495666723, 38.709130883216865]
    ];
    createBuilding(coords11, "58", "<b>Block 58 Details</b><br>Electrical and Computer Engineering Department.", classStyle);
    
    
    // --- BUILDING 12 (53) - Clinic (ORANGE) ---
    var coords12 = [
        [14.107354346519037, 38.70907187461853], [14.107567654295908, 38.70904505252839], 
        [14.107536438536142, 38.70889484882355], [14.107338738625081, 38.70892703533173]
    ];
    createBuilding(coords12, "52", "<b>Block 52 Details</b><br>University Clinic / Health Services.", healthStyle);

    
    // --- BUILDING 13 (56) - Computer Science Lab (GREEN) ---
    var coords13 = [
        [14.107068201626872, 38.709388375282295], [14.10719826753147, 38.709366917610176], 
        [14.107146241178535, 38.70899677276612], [14.107010972605336, 38.70900750160218]
    ];
    createBuilding(coords13, "53", "<b>Block 53 Details</b><br>Computer Science Lab.", classStyle);
    
    
    // --- BUILDING 14 (60) - Institute of Technology (GREEN) ---
    var coords14 = [
        [14.106542734616854, 38.70972096920014], [14.106168143533688, 38.70977461338043], 
        [14.1061473328999, 38.709635138511665], [14.106532329317293, 38.70958149433137]
    ];
    createBuilding(coords14, "60", "<b>Block 60 Details</b><br>Institute of Technology (IOT).", classStyle);
    
    
    // --- BUILDING 15 (17) - Haven Cafe (GOLD) ---
    var coords15 = [
        [14.110299016724552, 38.70610535144806], [14.110439485907428, 38.706164360046394], 
        [14.110585157561216, 38.70577275753022], [14.110465498709582, 38.70571911334992]
    ];
    createBuilding(coords15, "16", "<b>Block 17 Details</b><br>Haven Cafe.", commercialStyle);
    
    
    // --- BUILDING 16 (X) - Senior Students Cafe (GOLD) ---
    var coords16 = [
        [14.109279311912939, 38.70857298374177], [14.109586264351437, 38.70833158493043], 
        [14.109414579140164, 38.70809555053712], [14.109107626470465, 38.70833694934846]
    ];
    createBuilding(coords16, "X", "<b>Block X Details</b><br>Senior Students Cafe.", commercialStyle);
    
    
    // --- BUILDING 17 (Q) - Junior/Fresh Students Cafe (GOLD) ---
    var coords17 = [
        [14.108816281181301, 38.70794534683228], [14.109045195368424, 38.70774686336518], 
        [14.108821483779002, 38.70745182037354], [14.108587366764286, 38.707628846168525]
    ];
    createBuilding(coords17, "Q", "<b>Block Q Details</b><br>Junior/Fresh Students Cafe.", commercialStyle);
    
    
    // --- BUILDING 18 (50) - Conference Room (RED) ---
    var coords18 = [
        [14.10678205637556, 38.70874464511872], [14.1070057699663, 38.70869636535645], 
        [14.10696414884976, 38.70855689048767], [14.106756043153077, 38.70858371257783]
    ];
    createBuilding(coords18, "50", "<b>Block 50 Details</b><br>Conference Room / Meeting Space.", adminStyle);
    
    
    // --- BUILDING 19 (54) - Staff Lunch (GOLD) ---
    var coords19 = [
        [14.106839285454548, 38.70902359485627], [14.106704016699231, 38.70904505252839], 
        [14.106761245797813, 38.70944201946259], [14.106912122443395, 38.709425926208496]
    ];
    createBuilding(coords19, "54", "<b>Block 54 Details</b><br>Staff Lunch/Lounge.", commercialStyle);
    
    
    // --- BUILDING 20 (43) - Male Dormitory (BLUE) ---
    var coords20 = [
        [14.105268081887392, 38.70751082897186], [14.105585445069938, 38.7074625492096], 
        [14.105554229038793, 38.70721578598023], [14.105236865812788, 38.70725870132447]
    ];
    createBuilding(coords20, "43", "<b>Block 43 Details</b><br>Male Dormitory.", dormStyle);
    
    
    // --- BUILDING 21 (28) - Girls Dormitory (BLUE) ---
    var coords21 = [
        [14.107447993860282, 38.707644939422615], [14.10714103854259, 38.707682490348816], 
        [14.107109822724416, 38.70743572711945], [14.10741677808414, 38.707398176193244]
    ];
    createBuilding(coords21, "28", "<b>Block 28 Details</b><br>Girls Dormitory.", dormStyle);
    
    
    // --- BUILDING 22 (61) - Classrooms/Department (GREEN) ---
    var coords22 = [
        [14.106521924017262, 38.709908723831184], [14.106183751507766, 38.709957003593445], 
        [14.106209764795528, 38.710101842880256], [14.106547937266448, 38.71004819869996]
    ];
    createBuilding(coords22, "61", "<b>Block 61 Details</b><br>Classrooms / Department.", classStyle);
    
    
    // --- BUILDING 23 (64) - Classrooms/Department (GREEN) ---
    var coords23 = [
        [14.106355439152201, 38.7101823091507], [14.106397060379857, 38.71052026748658], 
        [14.10627219667407, 38.71053636074067], [14.106225372766769, 38.71021449565888]
    ];
    createBuilding(coords23, "64", "<b>Block 64 Details</b><br>Classrooms / Department.", classStyle);
    
    
    // --- BUILDING 24 (63) - Classrooms/Department (GREEN) ---
    var coords24 = [
        [14.106527126667341, 38.710622191429145], [14.10657395051267, 38.71096551418305], 
        [14.106698814053184, 38.71094405651093], [14.106662395527605, 38.710606098175056]
    ];
    createBuilding(coords24, "63", "<b>Block 63 Details</b><br>Classrooms / Department.", classStyle);
    
    
    // --- BUILDING 25 (62) - Classrooms/Department (GREEN) ---
    var coords25 = [
        [14.106584355810323, 38.710150122642524], [14.106454289555497, 38.71016621589661], 
        [14.106501113415776, 38.7104880809784], [14.106636382291484, 38.710471987724304]
    ];
    createBuilding(coords25, "62", "<b>Block 62 Details</b><br>Biology laboratory.", classStyle);


    // --- BUILDING 26 (52) - Lecture Hall (GREEN) ---
    var coords26 = [
        [14.105991253086037, 38.70869100093842], [14.106022469057349, 38.70884120464326], 
        [14.105809159834813, 38.708878755569465], [14.105783146501341, 38.708723187446594]
    ];
    createBuilding(coords26, "52", "<b>Block 52L Details</b><br>Lecture Hall.", classStyle);
    
    
    // --- BUILDING 27 (44) - Male Dormitory (BLUE) ---
    var coords27 = [
        [14.104165111325997, 38.70805799961091], [14.103847746166636, 38.708106279373176], 
        [14.103800921761463, 38.70784342288971], [14.104123489690915, 38.70781123638154]
    ];
    createBuilding(coords27, "44", "<b>Block 44 Details</b><br>Male Dormitory.", dormStyle);
    
    
    // --- BUILDING 28 (45) - Male Dormitory (BLUE) ---
    var coords28 = [
        [14.103863354299552, 38.707623481750495], [14.10419112484407, 38.70757520198823], 
        [14.104144300509404, 38.70733380317688], [14.10383213803265, 38.707371354103095]
    ];
    createBuilding(coords28, "45", "<b>Block 45 Details</b><br>Male Dormitory.", dormStyle);
    
    
    // --- BUILDING 29 (46) - Male Dormitory (BLUE) ---
    var coords29 = [
        [14.104035043691141, 38.70715141296387], [14.103712475636593, 38.70720505714417], 
        [14.10368646206392, 38.70694220066071], [14.10399342203233, 38.706904649734504]
    ];
    createBuilding(coords29, "46", "<b>Block 46 Details</b><br>Male Dormitory.", dormStyle);


    // --- BUILDING 30 (47) - Male Dormitory (BLUE) --- 
    var coords30 = [
        [14.103519975128572, 38.70681881904603], [14.10320260907139, 38.706851005554206], 
        [14.103171392714035, 38.70658278465272], [14.103488758814663, 38.70655596256257]
    ];
    createBuilding(coords30, "47", "<b>Block 47 Details</b><br>Male Dormitory.", dormStyle);
    
    
    // --- FEATURE 31 (Main Gate) - Landmark (GOLD) --- üÜï
    var coords31 = [
        [14.110730829121877, 38.71228516101838], [14.110605967789866, 38.71257483959199], 
        [14.110444688468109, 38.71246218681336], [14.110559144772726, 38.71225833892823]
    ];
    createBuilding(coords31, "Main Gate", "<b>Main Gate Details</b><br>The primary entrance to the university campus.", commercialStyle);



    // --- BUILDING 32 (34) - Male Dormitory (BLUE) --- üÜï
    var coords32 = [
        [14.10621496745273, 38.707398176193244], 
        [14.10632422322646, 38.707392811775215], 
        [14.106298209951753, 38.70709240436555],
        [14.106178548849863, 38.707108497619636]
    ];
    createBuilding(coords32, "34", "<b>Block 34 Details</b><br>Male Dormitory.", dormStyle);



    // --- BUILDING 33 (39) - Male Dormitory (BLUE) --- üÜï
    var coords33 = [
        [14.106480302812393, 38.706915378570564], 
        [14.106178548849863, 38.70695292949677], 
        [14.106131724923328, 38.70669543743134],
        [14.106438681599915, 38.706663250923164]
    ];
    createBuilding(coords33, "39", "<b>Block 39 Details</b><br>Male Dormitory.", dormStyle);



    // --- BUILDING 34 (41) - Male Dormitory (BLUE) --- üÜï
    var coords34 = [
        [14.106048482363517, 38.707414269447334], 
        [14.105965239773328, 38.70742499828339], 
        [14.10591321313903, 38.707129955291755],
        [14.106012063734061, 38.707119226455696]
    ];
    createBuilding(coords34, "41", "<b>Block 41 Details</b><br>Male Dormitory.", dormStyle);


    // --- BUILDING 35 (40) - Male Dormitory (BLUE) --- üÜï
    var coords35 = [
        [14.105970442436115, 38.70696365833283], 
        [14.10566348512913, 38.70700120925904], 
        [14.10561666109682, 38.70672762393952],
        [14.105939226457668, 38.70669543743134]
    ];
    createBuilding(coords35, "40", "<b>Block 40 Details</b><br>Male Dormitory.", dormStyle);



    // --- BUILDING 36 (57) - Classroom Block (GREEN) --- üÜï
    var coords36 = [
        [14.106386655073655, 38.7094795703888], 
        [14.106532329317293, 38.70945811271668], 
        [14.106475100161244, 38.70908260345459],
        [14.106329425881057, 38.709109425544746]
    ];
    createBuilding(coords36, "57", "<b>Block 57 Details</b><br>Classrooms and Department Offices.", classStyle);



    // --- BUILDING 37 (54) - Chemistry Laboratory (GREEN) --- üÜï
    var coords37 = [
        [14.107104620087632, 38.70996236801148], 
        [14.107026580521719, 38.71028423309326], 
        [14.106901717160705, 38.71026277542115],
        [14.106969351489738, 38.709935545921326]
    ];
    createBuilding(coords37, "x", "<b>Block x Details</b><br>Chemistry Laboratory.", classStyle);



    // --- BUILDING 38 (55) - Biology Laboratory (GREEN) --- üÜï
    var coords38 = [
        [14.10696414884976, 38.709849715232856], 
        [14.107120227997603, 38.70982825756074], 
        [14.107062998989147, 38.70949566364289],
        [14.106922527725628, 38.70952248573304]
    ];
    createBuilding(coords38, "55", "<b>Block 55 Details</b><br>physics Laboratory.", classStyle);


    // --- FEATURE 39 (Court) - Basketball Court (GOLD) --- üÜï
    var coords39 = [
        [14.105070380009401, 38.7053006887436], 
        [14.10446686795312, 38.705391883850105], 
        [14.104409638278668, 38.70497882366181],
        [14.105028758539554, 38.70489299297333]
    ];
    createBuilding(coords39, "Court", "<b>Basketball Court Details</b><br>Recreational Area.", commercialStyle);


    // --- FEATURE 40 (Field) - Football Field (GOLD) --- üÜï
    var coords40 = [
        [14.106475100161244, 38.70355188846589], 
        [14.104518894917444, 38.70353043079377], 
        [14.104591732647538, 38.704710602760315],
        [14.106475100161244, 38.70475888252259]
    ];
    createBuilding(coords40, "Football Field", "<b>Football Field Details</b><br>Main sports ground.", commercialStyle);


    // --- BUILDING 41 (27) - Classroom Block (GREEN) --- üÜï
    var coords41 = [
        [14.107089012176592, 38.7082725763321], 
        [14.107323130730071, 38.70822966098786], 
        [14.107307522833981, 38.70809555053712],
        [14.107068201626872, 38.708138465881355]
    ];
    createBuilding(coords41, "27", "<b>Block 27 Details</b><br>Classrooms and Offices.", classStyle);


    // --- BUILDING 42 (22) - Classroom Block (GREEN) --- üÜï
    var coords42 = [
        [14.10901918240419, 38.70716214179993], 
        [14.109253298975421, 38.70725333690644], 
        [14.109320932606794, 38.707113862037666],
        [14.109092018696558, 38.70702803134919]
    ];
    createBuilding(coords42, "22", "<b>Block 22 Details</b><br>Classrooms and Offices.", classStyle);


    // --- BUILDING 43 (94) - Admin Office Block (RED) --- üÜï
    var coords43 = [
        [14.108857901959695, 38.70723187923432], 
        [14.108998372030658, 38.707408905029304], 
        [14.108899522730482, 38.70747864246369],
        [14.108764255197604, 38.70729625225068]
    ];
    createBuilding(coords43, "94", "<b>Block 94 Details</b><br>Administrative Offices.", adminStyle);



    // --- BUILDING 44 (35) - Male Dormitory (BLUE) --- üÜï
    var coords44 = [
        [14.10656874786366, 38.706604242324836], 
        [14.106584355810323, 38.70672225952149], 
        [14.106870501309757, 38.70667397975922],
        [14.1068548933827, 38.70656669139863]
    ];
    createBuilding(coords44, "35", "<b>Block 35 Details</b><br>Male Dormitory.", dormStyle);



    // --- BUILDING 45 (38) - Male Dormitory (BLUE) --- üÜï
    var coords45 = [
        [14.10649591076511, 38.706169724464424], 
        [14.106532329317293, 38.706464767456055], 
        [14.106443884251902, 38.70647013187409],
        [14.106402263032772, 38.70618045330048]
    ];
    createBuilding(coords45, "38", "<b>Block 38 Details</b><br>Male Dormitory.", dormStyle);



    // --- BUILDING 46 (Green Cafe) - Commercial (GOLD) --- 
var coords46 = [
    [14.105647877119429, 38.70824038982392], 
    [14.105725917157246, 38.708631992340095], 
    [14.10603287438019, 38.70855689048767],
    [14.106017266395769, 38.708192110061646]
];
createBuilding(coords46, "Green Cafe", "<b>Green Cafe Details</b><br>Student cafe and lounge area.", commercialStyle);



// --- BUILDING 47 (71) - Journalism Department (GREEN) --- 
var coords47 = [
    [14.104196327547326, 38.70881438255311], 
    [14.104253557275314, 38.709238171577454], 
    [14.104113084280963, 38.70924353599548],
    [14.104061057224058, 38.70884120464326]
];
createBuilding(coords47, "71", "<b>Block 71 Details</b><br>Journalism Department.", classStyle);



// --- BUILDING 48 (73) - Classroom Block (GREEN) --- 
var coords48 = [
    [14.10399342203233, 38.709957003593445], 
    [14.104336800490408, 38.709903359413154], 
    [14.104342003190332, 38.71003210544587],
    [14.104024638277158, 38.71008574962617]
];
createBuilding(coords48, "73", "<b>Block 73 Details</b><br>Classrooms.", classStyle);



// --- BUILDING 49 (68) - Classroom Block (GREEN) --- 
var coords49 = [
    [14.104581327258948, 38.709871172904975], 
    [14.104596935341661, 38.70999991893769], 
    [14.104929907518239, 38.709957003593445],
    [14.104914299458324, 38.70981752872468]
];
createBuilding(coords49, "68", "<b>Block 68 Details</b><br>Classrooms.", classStyle);


// --- BUILDING 50 (69) - Drawing Class Block (GREEN) --- 
var coords50 = [
    [14.10462815150387, 38.7101823091507], 
    [14.104950718263131, 38.710134029388435], 
    [14.104976731691574, 38.71028423309326],
    [14.104643759583379, 38.71033787727357]
];
createBuilding(coords50, "69", "<b>Block 69 Details</b><br>Drawing Classrooms.", classStyle);


// --- BUILDING 51 (Social Library) - Commercial/Landmark (GOLD) --- 
var coords51 = [
    [14.109180462734576, 38.706657886505134], 
    [14.10901397981099, 38.706598877906806], 
    [14.109164854965657, 38.70622336864472],
    [14.109326135192982, 38.70628237724304]
];
createBuilding(coords51, "Social Library", "<b>Social Library Details</b><br>Main student study and resource center.", commercialStyle);



// --- BUILDING 52 (Natural Library) - Commercial/Landmark (GOLD) --- 
var coords52 = [
    [14.109315730020466, 38.70579421520234], 
    [14.109492617888598, 38.70584249496461], 
    [14.109612277250955, 38.70547235012055],
    [14.109456199809314, 38.70542407035828]
];
createBuilding(coords52, "Natural Library", "<b>Natural Library Details</b><br>Resource center for science and natural history topics.", commercialStyle);



// --- BUILDING 53 (23) - College of Business and Economics (GREEN) --- 
var coords53 = [
    [14.109028617130365, 38.70693625482277],
    [14.109111903739647, 38.70671085746235],
    [14.109002590058703, 38.70667865783943],
    [14.108924508825934, 38.706909421803644]
];
createBuilding(coords53, "23", "<b>Block 23 Details</b><br>College of Business and Economics.", classStyle);


// --- BUILDING 54 (21) - Classroom Block (GREEN) --- 
var coords54 = [
    [14.109627238958051, 38.70665719142418],
    [14.109684498354865, 38.706512293121065],
    [14.109497103911847, 38.70643179406376],
    [14.109439844467987, 38.706549859347795]
];
createBuilding(coords54, "21", "<b>Block 21 Details</b><br>Classrooms.", classStyle);


// --- BUILDING 55 (20) - Classroom Block (GREEN) --- 
var coords55 = [
    [14.109767784724498, 38.706823556142545],
    [14.10987189264379, 38.70687185557691],
    [14.109996822084149, 38.70657669236687],
    [14.10989271422193, 38.70652839293251]
];
createBuilding(coords55, "20", "<b>Block 20 Details</b><br>Classrooms.", classStyle);

// --- BUILDING 56 (19) - Classroom Block (GREEN) --- 
var coords56 = [
    [14.110022849042277, 38.70694162142657],
    [14.11012695684507, 38.70698992086094],
    [14.110241475373195, 38.70667865783943],
    [14.11013216223395, 38.70662499180125]
];
createBuilding(coords56, "19", "<b>Block 19 Details</b><br>Classrooms.", classStyle);


// --- BUILDING 57 (18) - Classroom Block (GREEN) --- 
var coords57 = [
    [14.110152983788312, 38.70651765972487],
    [14.110272707689072, 38.70621712991099],
    [14.110152983788312, 38.706179563684266],
    [14.110043670606627, 38.70648546010198]
];
createBuilding(coords57, "18", "<b>Block 18 Details</b><br>Classrooms.", classStyle);


// --- BUILDING 58 (15) - Classroom Block (GREEN) --- 
var coords58 = [
    [14.1101633945648, 38.70608833141936],
    [14.110064492169094, 38.70605076519263],
    [14.110179010728604, 38.70574486877495],
    [14.110277913074619, 38.70578780160548]
];
createBuilding(coords58, "15", "<b>Block 15 Details</b><br>Classrooms.", classStyle);


// --- BUILDING 59 (14) - Classroom Block (GREEN) --- 
var coords59 = [
    [14.1106474951457, 38.70631909538358],
    [14.110527771441818, 38.7062707959492],
    [14.110387226143981, 38.70664645821654],
    [14.11050694992169, 38.70670012425471]
];
createBuilding(coords59, "17", "<b>Block 14 Details</b><br>Classrooms.", classStyle);

// --- BUILDING 60 (Block 11) - Classroom Block (GREEN) --- 
var coords60 = [
    [14.110526896905231, 38.70546764143926],
    [14.11063620985517, 38.705183211436875],
    [14.110407173138004, 38.70508124596433],
    [14.110282243922535, 38.70538714238201]
];
createBuilding(coords60, "85", "<b>Block 11 Details</b><br>Classrooms and offices.", classStyle);


// --- BUILDING 61 (Football DSTV) - Recreational/Commercial (GOLD) --- 
var coords61 = [
    [14.111178442987633, 38.70703822029532],
    [14.111074335665128, 38.70734948331683],
    [14.110720370412905, 38.70721531822136],
    [14.11084529938823, 38.706904055199836]
];
createBuilding(coords61, "Football DSTV", "<b>Football DSTV Details</b><br>Common area for watching football matches and entertainment.", commercialStyle);


// --- BUILDING 62 (Classroom) - Academic (GREEN) --- 
var coords62 = [
    [14.109449146585083, 38.70621870586504],
    [14.109537638443213, 38.70599867510846],
    [14.109397092534824, 38.705955742277894],
    [14.10930339521447, 38.70615967322303]
];
createBuilding(coords62, "13", "<b>Classroom Details</b><br>Academic facility for lectures and studies.", classStyle);


// --- BUILDING 63 (Academic Block) - GREEN --- 
var coords63 = [
    [14.109903125010288, 38.70594343311624],
    [14.109949973552053, 38.705793168209325],
    [14.109746963134945, 38.70571803575582],
    [14.109700114551478, 38.70585756745515]
];
createBuilding(coords63, "14", "<b>Academic Block Details</b><br>Classrooms and faculty offices.", classStyle);


// --- BUILDING 64 (Academic Block) - GREEN --- 
var coords64 = [
    [14.10973655233945, 38.70515454235485],
    [14.109580390349977, 38.70511697612812],
    [14.10974175773725, 38.70465008159588],
    [14.10988750882758, 38.70470374763405]
];
createBuilding(coords64, "86", "<b>Academic Block Details</b><br>Classrooms and faculty offices.", classStyle);

// --- BUILDING 65 (Female Dormitory) - BLUE --- 
var coords65 = [
    [14.108950535906489, 38.70524577461979],
    [14.109013000887733, 38.70510624292048],
    [14.108633005320598, 38.70498281103264],
    [14.108575745659673, 38.70510624292048]
];
createBuilding(coords65, "6", "<b>Female Dormitory Details</b><br>Student housing for female students.", dormStyle);

// --- BUILDING 67 (Classroom Block) - Academic (GREEN) --- 
var coords67 = [
    [14.106613348646697, 38.70844129951705],
    [14.106592526769036, 38.70826956819484],
    [14.106384307887645, 38.70830176781772],
    [14.106389513362005, 38.708468132536126]
];
createBuilding(coords67, "50", "<b>Classroom Block Details</b><br>Academic facility for lectures and student activities.", classStyle);


// --- BUILDING 68 (Classroom Block) - Academic (GREEN) --- 
var coords68 = [
    [14.103916843242946, 38.70885749898997],
    [14.103963693014835, 38.70928682729547],
    [14.103833554735877, 38.70929756050312],
    [14.103765882801465, 38.70886823219757]
];
createBuilding(coords68, "72", "<b>Classroom Block Details</b><br>Academic facility for student lectures.", classStyle);


// --- BUILDING 69 (College of Social Science and Languages) - GREEN --- 
var coords69 = [
    [14.103968898544435, 38.70849793653407],
    [14.103984515132563, 38.70863210162955],
    [14.103750266198363, 38.70865893464863],
    [14.103719032988966, 38.70851940294936]
];
createBuilding(coords69, "Social Science", "<b>College of Social Science and Languages</b><br>Academic building housing various language and social science departments.", classStyle);


// --- BUILDING 70 (Pyramid Caffe) - Commercial (GOLD) --- 
var coords70 = [
    [14.10490315494175, 38.70869751508156],
    [14.104632468353326, 38.70872434810065],
    [14.104700140030545, 38.7091536764062],
    [14.104960415525037, 38.709126843387075]
];
createBuilding(coords70, "Pyramid Caffe", "<b>Pyramid Caffe</b><br>Campus cafeteria and student hang-out spot.", commercialStyle);


// --- BUILDING 71 (Male Dorm Block A) - BLUE --- 
var coords71 = [
    [14.10370628269158, 38.708070074893115],
    [14.103732310367837, 38.708166673761866],
    [14.103409566972262, 38.708220339800036],
    [14.103393950344772, 38.70809690791221]
];
createBuilding(coords71, "49", "<b>Male Dormitory Block A</b><br>Student housing for male students.", dormStyle);


// --- BUILDING 72 (Male Dorm Block B) - BLUE --- 
var coords72 = [
    [14.103284633922316, 38.70824180621533],
    [14.103066000920249, 38.708284739045894],
    [14.102987917654417, 38.70779101149453],
    [14.103175317447496, 38.70777491168309]
];
createBuilding(coords72, "79", "<b>Male Dormitory Block B</b><br>Student housing for male students.", dormStyle);


// --- BUILDING 73 (Male Dorm Block C) - BLUE --- 
var coords73 = [
    [14.103068340153461, 38.708626735025746],
    [14.10304751795207, 38.70842817068442],
    [14.102558195672037, 38.70847647011879],
    [14.102579017918108, 38.708685767667724]
];
createBuilding(coords73, "112", "<b>Male Dormitory Block C</b><br>Student housing for male students.", dormStyle);


// --- BUILDING 74 (Male Dorm Block D) - BLUE --- 
var coords74 = [
    [14.102657101323945, 38.708336938419514],
    [14.102422851026242, 38.70837450464625],
    [14.102349973106787, 38.70787004388724],
    [14.102558195672037, 38.70787004388724]
];
createBuilding(coords74, "89", "<b>Male Dormitory Block D</b><br>Student housing for male students.", dormStyle);



    // ==================================================
    // 8. SCALE BAR IMPLEMENTATION
    // ==================================================
    L.control.scale({ imperial: false }).addTo(map);


// TEMPORARY HELPER: Click map to get coordinates in console
map.on('click', function(e) {
    console.log("[" + e.latlng.lat + ", " + e.latlng.lng + "],");
});





// --- LIVE LOCATION TRACKING LOGIC ---
var userMarker = null;
var isTracking = false;

function toggleTracking() {
    const btn = document.getElementById('location-btn');
    if (!isTracking) {
        // watch: true makes it follow you as you walk
        map.locate({ watch: true, enableHighAccuracy: true, setView: true, maxZoom: 18 });
        isTracking = true;
        btn.style.background = "#007AFF";
        btn.style.color = "white";
    } else {
        map.stopLocate();
        if (userMarker) map.removeLayer(userMarker);
        userMarker = null;
        isTracking = false;
        btn.style.background = "white";
        btn.style.color = "black";
    }
}

map.on('locationfound', function(e) {
    if (!userMarker) {
        userMarker = L.circleMarker(e.latlng, {
            radius: 9,
            className: 'user-location-dot',
            fillOpacity: 1
        }).addTo(map);
        map.flyTo(e.latlng, 18); // Zoom to you the first time
    } else {
        userMarker.setLatLng(e.latlng); // Move the dot as you move
    }
});

map.on('locationerror', function() {
    alert("Location access denied. Please use HTTPS and enable GPS.");
});

</script>



